
## resolvectl query mbvm250102

![alt text](image.png)

## ceph 

### âœ… ææ¡ˆ

- æŒçºŒä½¿ç”¨ç¾æœ‰ Ceph æ¶æ§‹ï¼Œä½œç‚º PVEï¼ˆProxmox VEï¼‰é‹è¡Œå¹³å°çš„æ ¸å¿ƒå„²å­˜å±¤ã€‚

### ğŸ“Œ ææ¡ˆç·£ç”±

é›–ç„¶ç›®å‰å° Ceph é‚„ä¸å¤ ç†Ÿæ‚‰ï¼Œä½†ç¶“échatgetæ·±å…¥ä¸€é»çš„äº†è§£èˆ‡è¨è«–ï¼Œèªç‚ºå…¶å…·å‚™ï¼š

- åˆ†æ•£å¼æ¶æ§‹çš„å¯æ“´å±•æ€§

- å„²å­˜èˆ‡é«˜å¯ç”¨æ€§çš„é•·æœŸå„ªå‹¢

å› æ­¤å»ºè­°å…ˆä¿ç•™ä¸¦åœ¨æ¬ç§»å‘½åä¸­é€æ­¥ç†Ÿæ‚‰ Ceph æ¶æ§‹ï¼Œå†è©•ä¼°æ˜¯å¦é€²ä¸€æ­¥æ“´å……æˆ–èª¿æ•´æ–¹å‘ã€‚

### ğŸ’¡ å‚™è¨»
- è‹¥å¾ŒçºŒæ¸¬è©¦æˆ–ç¶­é‹è² æ“”éé«˜ï¼Œä»å¯ä¿ç•™è½‰å‘ NFS æˆ–å…¶ä»–æ··åˆæ¶æ§‹çš„å½ˆæ€§ç©ºé–“ã€‚

- å¯åœ¨éæ­£å¼å€åŸŸï¼ˆå¦‚ Dev/Test ç¯€é»ï¼‰é€²è¡Œ Ceph çš„åŠŸèƒ½æ€§èˆ‡é¢¨éšªè©•ä¼°ã€‚

### å¯ç”¨

ç°¡ä»‹
https://chatgpt.com/share/689a98b2-f8f0-800c-87f6-f98ced8539ea
ceph ç­–ç•¥ (å€’æ•¸3rd chat æœ‰é€Ÿè¦½)
https://chatgpt.com/share/689a9891-a68c-800c-9432-9612709266f2

### æ¡†æ¶è¦åŠƒ

æ¡†æ¶ v0

``` yaml
test_cluster:

  description: æ¸¬è©¦ç’°å¢ƒï¼Œæ¨¡æ“¬ OSD é…ç½®èˆ‡å®¹éŒ¯è¡Œç‚º

  nodes:

    - name: host_a
      osd_count: 1

    - name: host_b
      osd_count: 1

    - name: host_c
      osd_count: 2
      disk_layout: "1 ç£ç¢Ÿåˆ†å‰²æˆ 2 OSD"

    - name: host_d
      osd_count: 0
      purpose: "æ¨¡æ“¬ host æ›æ‰æ™‚ OSD ç§»å‹• / Ceph å›å¾©"

prod_cluster:

  description: æ­£å¼ç’°å¢ƒï¼Œä¾æ‡‰ç”¨éœ€æ±‚å€åˆ†ç¯€é»åŠŸèƒ½

  node_types:

    - role: low_pool_node
      osd_per_node: "3~4"
      network: "10Gbps x1"
      scalable: true
      usage: "ä¸€èˆ¬å„²å­˜æ± ï¼Œä¸­ä½ IOPS"

    - role: high_pool_node
      osd_per_node: "ä¾ç£ç¢Ÿæ•¸èª¿æ•´"
      network: "10Gbps x2"
      bonding: true
      usage: "é«˜æ•ˆèƒ½å„²å­˜æ± ï¼Œå¦‚ DBã€ML"

    - role: monitor_mgr_node
      osd_per_node: 0
      network: "1Gbps or 10Gbps"
      deploy_option: "å¯æ··åˆæˆ–ç¨ç«‹éƒ¨ç½²"
      usage: "ç›£æ§èˆ‡ç®¡ç†ç¯€é»"
```
---

#### ğŸ§ª æ¸¬è©¦ç’°å¢ƒè¦åŠƒï¼ˆTest Clusterï¼‰

| ä¸»æ©Ÿé¡å‹   | OSD æ•¸é‡ | å‚™è¨»         |
| ------ | ------ | ---------- |
| Host A | 1      |            |
| Host B | 1      |            |
| Host C | 2      | OSD åˆ†å‰²1ç£ç¢Ÿæˆ2ä»½osdåšæ¸¬è©¦ |
| Host D | 0      | ç”¨ä½œæ¸¬è©¦host æ›æ‰æ™‚ osd æ¬ç§»ã€ceph å›å¾© |

âœ… **ç¸½çµï¼š** æ¸¬è©¦ç’°å¢ƒå…± 4 å°ä¸»æ©Ÿï¼Œå…¶ä¸­ 3 å°å…·æœ‰ OSDï¼Œåˆè¨ˆ 3 é¡† OSDã€‚


#### ğŸ—ï¸ æ­£å¼ç’°å¢ƒè¦åŠƒï¼ˆProduction Clusterï¼‰

| ç¯€é»é¡å‹         | OSD æ•¸é‡ / ä¸»æ©Ÿ | ç¶²è·¯è¦æ ¼             | ç”¨é€”      | å‚™è¨»                  |
| ------------ | ----------- | ---------------- | ------- | ------------------- |
| Low Pool ç¯€é»  | 3\~4 é¡† OSD  | å–® 10 Gbps        | ä¸€èˆ¬å„²å­˜æ±    | æ”¯æ´æ©«å‘æ“´å……ï¼ˆn å°ï¼‰         |
| High Pool ç¯€é» | ç„¡ç‰¹å®š OSD æ•¸é‡  | é›™ 10 Gbps        | é«˜æ•ˆèƒ½å„²å­˜æ±   | é«˜ IOPS æ‡‰ç”¨ï¼Œå¦‚ DB / ML |
| Monitor/Mgr  | ç„¡           | 1 Gbps / 10 Gbps | ç®¡ç†/ç›£æ§ç¯€é» | å¯æ··åˆéƒ¨ç½²æˆ–ç¨ç«‹è¨­ç¯€é»         |

---

##### 1. **Low Pool ç¯€é»**

* æ¯å°éƒ¨ç½² **3\~4 é¡† OSD**
* ç¶²è·¯ç‚º **å–® 10 Gbps**ï¼Œé©åˆå¸¸è¦å„²å­˜éœ€æ±‚
* é©ç”¨æ–¼å¤§å¤šæ•¸ä¸­ä½ IOPS æ‡‰ç”¨
* æ¶æ§‹è¨­è¨ˆæ”¯æ´ **å½ˆæ€§æ“´å……ï¼ˆscale-outï¼‰**

##### 2. **High Pool ç¯€é»**

* æ¯å°éƒ¨ç½²é«˜æ•ˆèƒ½å„²å­˜çµ„æ…‹ serverï¼ŒOSD æ•¸é‡ä¾ç£ç¢Ÿè¨­è¨ˆå½ˆæ€§é…ç½®
* ç¶²è·¯ç‚º **é›™ 10 Gbps**ï¼ˆå»ºè­° Bonding / LACPï¼‰
* é©ç”¨æ–¼é«˜ IOPS / ä½å»¶é²æ‡‰ç”¨ï¼Œå¦‚è³‡æ–™åº«ã€æ©Ÿå™¨å­¸ç¿’ç­‰
* å¯ä½œç‚º Tiered Storage ä¸­çš„ **é«˜é€Ÿå±¤**

##### 3. **Monitor / Manager ç¯€é»**

* æä¾› Cluster çš„ç‹€æ…‹ç®¡ç†èˆ‡èª¿åº¦åŠŸèƒ½
* å¯èˆ‡å…¶ä»–ç¯€é»å…±ç”¨è³‡æºï¼Œæˆ–ç¨ç«‹éƒ¨ç½²ä»¥æå‡ç©©å®šæ€§
* ç¶²è·¯å¸¶å¯¬éœ€æ±‚è¼ƒä½ï¼Œä½†å»ºè­°ä½¿ç”¨èˆ‡å¢é›†ä¸€è‡´çš„é«˜é€Ÿé€£ç·šä»¥é¿å…ç“¶é ¸

---

### æ¸¬è©¦è¦åŠƒ

#### v0

çŸ­: osd æ›æ©Ÿå™¨é‡é–‹èµ·ä¾†ã€vm æ‰¹æ¬¡æ¬ç§»ã€æ¨¡æ“¬ host/osd æ›æ‰å¾©åŸ 

ä¸­: osd dead/out çš„ æ•ˆèƒ½/é€Ÿç‡æ¯”è¼ƒã€å¯ç”¨æ€§åˆ†æ 

é•·: Prod / Test / Dev clusters æ¶è¨­ (æ»¾å‹•è¦åŠƒ)  

ç„¡: ç¶­é‹æ¨¡çµ„ã€å‚™ä»½ã€ceph æ›´æ–° & ç›£æ§æ•´åˆ(squid (19+) å¾Œæœ‰ prometheus_stack)

#### v1

``` yml
test_plan:
  short_term:
    duration: "1~2 é€±"
    goals:
      - OSD æ›æ©Ÿæ¸¬è©¦
      - VM æ‰¹æ¬¡æ¬ç§»
      - æ¨¡æ“¬ host/osd æ›æ‰èˆ‡å›å¾©
    exit_criteria:
      - è‹¥ recovery è¶…é 1 å°æ™‚ä»æœªå®Œæˆ â†’ åœæ­¢æ·±å…¥
      - è‹¥å¢é›†å¥åº·åœ¨ 30 åˆ†é˜å…§ç„¡æ³•å›ç©© â†’ è©•ä¼°è½‰å‘ NFS ç‚ºå‚™æ´å±¤

  mid_term:
    duration: "2~4 é€±"
    goals:
      - OSD dead/out æ•ˆèƒ½æ¸¬è©¦
      - å¯ç”¨æ€§åˆ†æï¼ˆå¤š OSD å¤±æ•ˆï¼‰
    exit_criteria:
      - è‹¥æ•ˆèƒ½å›å¾©æœŸé–“ VM æ˜é¡¯å¡é “ (>10%) â†’ è©•ä¼°æ›¿ä»£æ–¹æ¡ˆè£œä½
      - è‹¥æ¸¬è©¦å£“åŠ›é€ æˆçœŸå¯¦é‹ç‡Ÿé¢¨éšª â†’ å„ªå…ˆåˆ‡åˆ†ç’°å¢ƒ

  long_term:
    duration: "1~2 å€‹æœˆ"
    goals:
      - æ¶è¨­ Dev / Test / Prod cluster
      - æ»¾å‹•æ›´æ–°ã€æ“´å±•æ¨¡æ“¬
    exit_criteria:
      - è‹¥æ¸¬è©¦è³‡æºæŒçºŒå¹²æ“¾ Prod VM/NFS â†’ å„ªå…ˆæ‹‰æ–°æ¡†æ¶åˆ†é›¢
      - è‹¥å¯¦ä½œç¶­è­·æˆæœ¬éé«˜/äººåŠ›ç„¡æ³•æ”¯æ’ â†’ æ¡ NFS + Ceph æ··åˆæ¶æ§‹ä¸¦è¡Œ
    
  infinite_term:
    duration: "inf"
    goals:
      - ç¶­é‹æ¨¡çµ„è¦åŠƒ (scripts kits...) / github prometheus tool
      - å‚™ä»½ ã€ routineæ¬ç§» è‡ªå‹•åŒ–æ’ç¨‹
      - ceph æ›´æ–° & ç›£æ§æ•´åˆ (prometheus + grafana + node_exporter)
    exit_criteria:
      - ç¶­è­·æˆæœ¬é–‹å§‹æš´å¢
    
```

### ç¶­é‹æ¨¡çµ„è©•ä¼°?

- è…³æœ¬æ¶æ§‹

